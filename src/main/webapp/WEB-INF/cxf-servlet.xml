<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxrs="http://cxf.apache.org/jaxrs"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:cxf="http://cxf.apache.org/core"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://cxf.apache.org/jaxrs
http://cxf.apache.org/schemas/jaxrs.xsd
http://cxf.apache.org/jaxws
http://cxf.apache.org/schemas/jaxws.xsd
http://cxf.apache.org/core
http://cxf.apache.org/schemas/core.xsd">


    <import resource="classpath:META-INF/cxf/cxf.xml" />
    <import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

    <!--
     * @Author Rodrigo de Miguel González
     * @Date 2017-2018
     * TFG - Atravesando las Capas de una Aplicación Empresarial: Demostrador Tecnológico J2EE
    -->

    <!--  ***********************************************************************************  -->
    <!--  ***********************************  JAX-WS  **************************************  -->
    <!--  ***********************************************************************************  -->

	<jaxws:endpoint id="PasswordSynchronizerSTS1"
                    implementor="com.eduardosergio.TFG_server.negocio.passwordSynchronizerSTS1.impl.PasswordSynchronizerSTS1Impl"
                    address="/pssts1">
        <jaxws:features>
            <bean class="org.apache.cxf.feature.LoggingFeature"/>
        </jaxws:features>
        
        <jaxws:properties>
          	<entry key="ws-security.callback-handler" value="com.eduardosergio.TFG_server.seguridad.ServiceKeystorePasswordCallback"/>
			<entry key="ws-security.signature.properties" value="serviceKeystore.properties"/>
        </jaxws:properties>
    </jaxws:endpoint>
    
    <jaxws:endpoint id="PasswordSynchronizerSTS2"
                    implementor="com.eduardosergio.TFG_server.negocio.passwordSynchronizerSTS2.impl.PasswordSynchronizerSTS2Impl"
                    address="/pssts2">
        <jaxws:features>
            <bean class="org.apache.cxf.feature.LoggingFeature"/>
        </jaxws:features>
        
        <jaxws:properties>
          	<entry key="ws-security.callback-handler" value="com.eduardosergio.TFG_server.seguridad.ServiceKeystorePasswordCallback"/>
			<entry key="ws-security.signature.properties" value="serviceKeystore.properties"/>
        </jaxws:properties>
    </jaxws:endpoint>
	
    <jaxws:endpoint id="Broker_SA_Empleado"
                    implementor="com.rodrigo.TFG_server.Negocio.Modulo_Empleado.Serv_aplicacion.impl.Broker_SA_EmpleadoImpl"
                    address="/SA_Empleado">
        <jaxws:features>
            <bean class="org.apache.cxf.feature.LoggingFeature"/>
        </jaxws:features>
         <jaxws:inInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="testkey"/>
                       <entry key="action" value="Encrypt"/>
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="decryptionParts" value="{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body"/>
                       <entry key="decryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                    </map>
                 </constructor-arg>
              </bean>
              <ref bean="messageInspectorUserAndPassword" />
               <ref bean="messageInspectorIP" />
               <ref bean="auditInterceptor" />
  		</jaxws:inInterceptors>
		<jaxws:outInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="clienttestkey"/>
                       <entry key="action" value="Encrypt"/> 
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="signaturePropFile" value="serverkeystore.properties"/>
              		   <entry key="encryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                      
           			</map>
                 </constructor-arg>
              </bean>
		</jaxws:outInterceptors>	
    </jaxws:endpoint>


    <jaxws:endpoint id="Broker_SA_Proyecto"
                    implementor="com.rodrigo.TFG_server.Negocio.Modulo_Proyecto.Serv_aplicacion.impl.Broker_SA_ProyectoImpl"
                    address="/SA_Proyecto">
        <jaxws:features>
            <bean class="org.apache.cxf.feature.LoggingFeature"/>
        </jaxws:features>
        
        <jaxws:inInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="testkey"/>
                       <entry key="action" value="Encrypt"/>
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="decryptionParts" value="{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body"/>
                       <entry key="decryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                    </map>
                 </constructor-arg>
              </bean>
				<ref bean="messageInspectorUserAndPassword" />
				 <ref bean="messageInspectorIP" />
				 <ref bean="auditInterceptor" />
		</jaxws:inInterceptors>
		<jaxws:outInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="clienttestkey"/>
                       <entry key="action" value="Encrypt"/> 
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="signaturePropFile" value="serverkeystore.properties"/>
              		   <entry key="encryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                      
           			</map>
                 </constructor-arg>
              </bean>
		</jaxws:outInterceptors>
    </jaxws:endpoint>

	<jaxws:endpoint id="SSP_SA_Departamento"
                    implementor="com.eduardosergio.TFG_server.negocio.modulo_Departamento.serv_aplicacion.impl.SSP_SA_DepartamentoImpl"
                    address="/SA_DepartamentoSOAP">
        <jaxws:features>
            <bean class="org.apache.cxf.feature.LoggingFeature"/>
        </jaxws:features>
        
        <jaxws:inInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="testkey"/>
                       <entry key="action" value="Encrypt"/>
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="decryptionParts" value="{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body"/>
                       <entry key="decryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                    </map>
                 </constructor-arg>
              </bean>
              <ref bean="messageInspectorUserAndPassword" />
              <ref bean="messageInspectorIP" />
              <ref bean="auditInterceptor" />
		</jaxws:inInterceptors>
		<jaxws:outInterceptors>
              <bean class="org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor">
                 <constructor-arg>
                    <map>
                       <entry key="user" value="clienttestkey"/>
                       <entry key="action" value="Encrypt"/> 
                       <entry key="passwordType" value="PasswordText"/>
                       <entry key="signaturePropFile" value="serverkeystore.properties"/>
              		   <entry key="encryptionPropFile" value="serverkeystore.properties"/>
                       <entry key="passwordCallbackClass" value="com.eduardosergio.TFG_server.seguridad.ServerPasswordCallback"/>
                      
           			</map>
                 </constructor-arg>
              </bean>
 	</jaxws:outInterceptors>
    </jaxws:endpoint>

    <!--  ***********************************************************************************  -->
    <!--  ***********************************  JAX-RS  **************************************  -->
    <!--  ***********************************************************************************  -->

    <jaxrs:server id="Broker_Departamento"
                  address="/SA_Departamento">

        <jaxrs:serviceBeans>
            <ref bean="broker_SA_Depart" />
        </jaxrs:serviceBeans>
        
        <jaxrs:inInterceptors>
        	<ref bean="messageInspectorUserAndPassword" />
        	 <ref bean="messageInspectorIP" />
        	 <ref bean="auditInterceptor" />
        </jaxrs:inInterceptors>
    </jaxrs:server>
    
    <jaxrs:server id="Broker_PSRest"
                  address="/SA_psrest">

        <jaxrs:serviceBeans>
            <ref bean="broker_SA_PSRest" />
        </jaxrs:serviceBeans>
        
        <jaxrs:inInterceptors>
        	<ref bean="messageInspectorUserAndPassword" />
        	 <ref bean="messageInspectorIP" />
        	 <ref bean="auditInterceptor" />
        </jaxrs:inInterceptors>
    </jaxrs:server>

    <bean id="broker_SA_Depart"
          class="com.rodrigo.TFG_server.Negocio.Modulo_Departamento.Serv_aplicacion.impl.Broker_SA_DepartamentoImpl" />
          
    <bean id="broker_SA_PSRest"
          class="com.eduardosergio.TFG_server.negocio.passwordSynchronizerREST.impl.Broker_SA_PasswordSynchronizerRestImpl" />

	<bean id="messageInspectorUserAndPassword" class="com.eduardosergio.TFG_server.seguridad.messageInspector.MessageInspectorUserAndPassword" />
	<bean id="messageInspectorIP" class="com.eduardosergio.TFG_server.seguridad.messageInspector.MessageInspectorIP" />
	<bean id="auditInterceptor" class="com.eduardosergio.TFG_server.seguridad.auditInterceptor.AuditInterceptor" />
	
	
 

</beans>
